#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# NOTE: !!!
# !!
# Now that I have gotten my GHM command to work properly almost I can begin
# to rethink how I should do this because now I could just keep everything
# in the ghm tree and then pull anything from there. that would actually be
# quite smart in thi s caes .
#
# This means that a big part of my own config is dependent on the fact that
# I have ghm setup and running so that I can load all of my repos with this.

DORO_USER_XDG="$DOROTHY/user/config.xdg"

function pull_molleweide_latest() {
	pushd $DOROTHY/user >/dev/null 2>&1
	echo "doro user pwd: $PWD"
	popd >/dev/null 2>&1
}

function setup_symlink_configs() {
	for f in "$DORO_USER_XDG"/*; do
		if test "$(basename "$f")" = "_"; then
			continue
		fi
		symlink-helper --existing="$f" --symlink="$XDG_CONFIG_HOME/$(basename "$f")"
	done
}

function setup_neovim() {
	doom_nvim_dir="$HOME/code/doom-nvim"
	if [ ! -d "$HOME/code/doom-nvim" ]; then
		git clone git@github.com:molleweide/doom-nvim.git "$doom_nvim_dir"
	fi
	symlink-helper --existing="$doom_nvim_dir" --symlink="$XDG_CONFIG_HOME/nvim"
}

function setup_osx() {
	# setup-user-osx
	:
}

function setup_hammerspoon() {
	if is-mac; then
		HAMMERSPOON_CONFIG_DIR="$HOME/code/config_hammerspoon"

		if [ ! -d "$HOME/code/config_hammerspoon" ]; then
			git clone git@github.com:molleweide/config_hammerspoon.git "$HAMMERSPOON_CONFIG_DIR"
		fi

		github.com/molleweide/config_hammerspoon

		echo-style --h1="Setting up HAMMERSPOON.."

		# brew install --cask hammerspoon # --appdir=/Applications

		url="https://github.com/Hammerspoon/Spoons/raw/master/Spoons/SpoonInstall.spoon.zip"
		destination=/tmp/SpoonInstall.spoon.zip
		spoons_dir=$HOME/.config/hammerspoon/Spoons

		if [ ! -d "$spoons_dir/SpoonInstall.spoon" ]; then
			wget -nv $url -O $destination && unzip -d "$spoons_dir" "$destination"
		fi

		defaults write org.hammerspoon.Hammerspoon MJConfigFile "~/.config/hammerspoon/init.lua"

		# fix: how should I manage the hammerspoon config
		symlink-helper --existing="$doom_nvim_dir" --symlink="$XDG_CONFIG_HOME/nvim"
		symlink-file "$ghq_user/config_hammerspoon" "$XDG_CONFIG_HOME/hammerspoon"

		:
	fi
}

function setup_obs() {
	# ~/Library/Application Support/obs-studio/
	# ~/.config/obs-studio/
	:
}

# RUN TASKS.........

# pull_molleweide_latest
# setup_symlink_configs
# setup_neovim
# setup_osx
